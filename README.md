# Jerk-Alarm

## ジャーク検出による二度寝防止アラーム

> 注1）起きるのはできるけど起き続けられない人向けのアラームです  
> 注2）多忙な浪人生が設計したため、**最低限の機能のみ**です  

---

### 📌 概要

従来の目覚ましと異なり、「ジャーク（加加速度）」を検出して動作します。  
つまり、**体が動いていない限りアラームが鳴り続ける**のが特徴です。

---

### 💡 ジャークとは？

- **加速度の時間微分**（加加速度）
- 地球上では重力加速度が常にかかっているため、**「静止している」＝「加速度ゼロ」とは限らない**
- そこで、**時間変化率＝ジャーク**を使えば、体動の有無を確実に判定できる

> ※本機にはフィルターをつける時間がありませんでした（設計者が忙しかったため）

---

### 🔔 アラーム動作の流れ

1. あらかじめ指定した時間が経過すると**監視モードに移行**
2. ジャークが一定時間検出されない場合にブザーが鳴動
3. 所定の監視時間（例：15分）が経過したら自動終了

→ 起きて作業していれば鳴らない。**布団で再度寝ていたら即バレて鳴る**！

---

# 🔧 作り方

## 前提スキル

- はんだ付け（最低限）
- Arduino IDEの導入・基本操作
- `.ino`ファイルの編集・書き込み

---

## 🛠 使用部品（すべて秋月電子で入手可能）

- [Seeed XIAO BLE Sense nRF52840](https://akizukidenshi.com/catalog/g/g117342/)
- [電子ブザー 12mm UDB-05LFPN](https://akizukidenshi.com/catalog/g/g109704/)
- [電池ボックス 1/2AA×1本用（リード付）](https://akizukidenshi.com/catalog/g/g109704/)
- [1/2AAサイズ形 リチウム電池 3.6V](https://akizukidenshi.com/catalog/g/g103222/)

---

## 🔌 接続図

![XIAOピン配置](https://files.seeedstudio.com/products/102010328/img/Seeeduino-XIAO-pin-out.jpg)

| XIAOピン | 接続先 |
|----------|--------|
| `GND`    | ブザーのマイナス、電池のマイナス |
| `D7`     | ブザーのプラス |
| `3V3`    | 電池のプラス |

---

## 🖥 IDEの準備と書き込み

1. このリポジトリから `jerk-alarm.ino` をダウンロード
2. Arduino IDEで開く
3. 必要なライブラリをインストール（例：`LSM6DS3`, `MadgwickAHRS` など）  
   ※ ライブラリ不足でビルドエラーになる場合は適宜調べて導入  
   ※ 書いている本人も1年経って忘れたのでここは雑です🙏

---

# ⏰ アラーム設定方法

## ① 動作時間の設定（旧バージョン）

```cpp
static float stand_by_time = 6680;  // アラーム起動までの待機時間（1単位 ≒ 3.5秒）
static float running_time = 6700;   // アラームの終了時間（起動からの持続時間）
```

> ⚠ この方式はループ回数依存のため不正確です  
> → ChatGPTに修正してもらった `jerk-alarm-new.ino` を同梱していますが、**未実機検証です**

---

## ② 動作時間の設定（新バージョン）

`jerk-alarm-new.ino` では `millis()` を使って正確な時間で動作します：

```cpp
const unsigned long stand_by_time_sec = 1800;    // 起動から30分後に監視開始
const unsigned long running_time_sec = 1890;     // さらに15分後に監視終了
```

→ 単位は**秒**なので直感的に設定できます。

---

## ③ 無動作と判定する時間のしきい値

```cpp
static int accel_limit = 2000;
```

- ここを変更すると、「どれだけ動いていなければブザーが鳴るか」を調整できます
- 値を小さくすると**敏感に反応**
- 大きくすると**余裕を持って判定**

---

## 🔗 参考にした記事

加速度センサの使い方などに関して以下を参考にしました：

[Seeed XIAO BLE nRF52840 Senseで6軸センサを使う](https://qiita.com/mizuhugu/items/47d56556ddab21049b7f)

---

## ✅ 最後に

この目覚ましは、「**アラームを止めてもまた寝ちゃう問題**」を**物理で解決**する試みです。  
雑ですが、**ちゃんと目は覚めます。寝てたら鳴ります。寝続けたら地獄です。**

---
